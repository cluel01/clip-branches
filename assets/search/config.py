"""
Configurations variables for the search service.
"""
from pydantic_settings import BaseSettings

#TODO Align the naming conventions of the kdtree parameters!

#laion nsfw idxs: 272479,323384,360438,326145,331138,476013,469481,462873,412529,95794,94170,80184,112084,104188,54513,63963,54901,49819,267420,215854,239557,137465,127642,190573,820351,807225,848196,748594

class Settings(BaseSettings):
    """Settings for the search service."""

    app_name: str = "Search Service"

    class Config:
        cfg = {
                "laion_262m_var": {
                        "display_name": "laion_262m",
                        "feature_file": "assets/laion_features_d32_uint8_v6.npy",#"assets/nrw_test_area_mapping.npy", #"assets/mapping_V2_part_50.npy",
                        "feature_mmap_path": "indexes/features",
                        "feature_mmap_dtype": "uint8",
                        "size_dataset": 262_563_993, 
                        "features_inmemory": True,#True, #False, for mmap
                        "non_rare_idxs": "auto",
                        "non_rare_idxs_num": 100_000,#30_000,
                        "nfeat":32,
                        "seed": 42,
                        "kdt_search":{
                                "index_file": None,#"assets/feature_subsets.npy",
                                "index_dir": "indexes/laion_var",
                                "leafsize": 4500,
                                "dtype":"uint8",
                                "build_inmemory":True,
                                "fidx_cfg": {"nfeat": "variable","cfg":{4:64,6:32,8:8}},
                                # "fidx_cfg": {"nfeat": "variable","cfg":{4:64,6:32}},
                                # "fidx_cfg": {"nfeat": "variable","cfg":{4:64,6:32,8:16}},#{"nfeat":8,"nind":32},#{"nfeat": 4,"nind":50},
                        },
                        "kdt_textsearch":{
                                "type": "kdtree",
                                "index_file": None,#"assets/feature_subsets.npy",
                                "index_dir": "indexes/laion_text",
                                "leafsize": 4500,
                                "dtype":"uint8",
                                "inmemory":False,
                                "build_inmemory":True,
                                "fidx_cfg": {"nfeat":32,"nind":1},
                                "stop_leaves": 3000,#500,
                        },
                        # "kdt_textsearch":{
                        #         "type": "faiss",	
                        #         "index_dir": "indexes/laion_text_faiss",
                        #         "index_file": "laion_flat_index.index",
                        # },
                        # "kdt_textsearch":{
                        #         "type": "treeset",	
                        # },

                        "text_searcher":{
                                "model_weights_path":"assets/clip_weights_v6.pth",
                                "model_type": "CLIP",
                                "clip_cfg": {"model":"ViT-B/32","device":"cpu","train":False,"custom_head":True,"embed_dim":32,"hidden_dim":8192},
                        },
                        "searcher": {
                                "db-maxevals0.5-demo": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":False,"min_pts":"auto"},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "db-maxevals0.5-min2": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":False,"min_pts":"auto"},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": 2,
                                },
                                "db-maxevals0.5-topDown": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":True,"max_evals":0.5,"stop_infinite":False,"postTree":False,"min_pts":"auto"},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "db-maxevals0.5-postTree": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":True,"min_pts":"auto"},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "db-maxevals1.0-demo": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":"all","stop_infinite":False,"postTree":False,"min_pts":"auto"},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "db-maxevals0.5-min2-stop": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":True,"postTree":False,"min_pts":"auto"},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": 2,
                                },
                                "db-maxevals1.0-demo-stop": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":"all","stop_infinite":True,"postTree":False,"min_pts":"auto"},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "db-maxevals1.0-postTree-stop": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":"all","stop_infinite":True,"postTree":True,"min_pts":"auto"},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "db-maxevals0.5-postTree-stop": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":True,"postTree":True,"min_pts":"auto"},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "db-maxevals0.5-postTree-stop-minPts50": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":True,"postTree":True,"min_pts":"auto"},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "db-maxevals1.0-topDown-stop": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":True,"max_evals":"all","stop_infinite":True,"postTree":False,"min_pts":"auto"},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "db-maxevals0.5-topDown-stop": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":True,"max_evals":0.5,"stop_infinite":True,"postTree":False,"min_pts":"auto"},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "ens-small-stop": {
                                        "ens_nestimators":11,
                                        "db_cfg":{"max_nbox":5,"top_down":False,"max_evals":"auto","stop_infinite":True,"postTree":False,"min_pts":"auto"},
                                        "njobs": None,
                                        "display_name": "Decisionbranches Ensemble",
                                        "dtype":"float64",
                                },
                                "ens-small": {
                                        "ens_nestimators":11,
                                        "db_cfg":{"max_nbox":5,"top_down":False,"max_evals":"auto","stop_infinite":False,"postTree":False,"min_pts":"auto"},
                                        "njobs": None,
                                        "display_name": "Decisionbranches Ensemble",
                                        "dtype":"float64",
                                },
                                "ens": {
                                        "ens_nestimators":25,
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":False,"min_pts":"auto"},
                                        "njobs": None,
                                        "display_name": "Decisionbranches Ensemble (25 trees)",
                                        "dtype":"float64",
                                },
                                "dtree": {
                                        "dtree_cfg":{},
                                        "display_name": "Decision Tree",
                                        "dtype":"float32",

                                },
                                "rf": {
                                        "rf_cfg": {"n_estimators":25},
                                        "display_name": "Random Forest (25t)",
                                        "dtype":"float32",
                                },
                                "nn":{
                                        "nn_k": 1000,
                                        "display_name": "Nearest Neighbor Search (k=1000)",
                                },
                                # "boxnet1":{
                                #     "display_name": "HyperNN",
                                #     "nboxes":150,
                                #     "scaling":True,
                                #     "dtype": "float32",
                                #     "cfg": {"training_epochs":1000,
                                #             "verbose":True,"l1_reg":0,
                                #             "patience_early_stopping":500,"l2_reg":0,
                                #             "learning_rate":1e-1,
                                #             "num_threads":10,
                                #             "alpha_tau_decay_step":25,
                                #             "box_pruning_step":250,
                                #             },
                                # },
                        }

                  },
            
                # "laion_262m_d8": {
                #         "display_name": "laion_262m",
                #         "feature_file": "assets/laion_features_d32_uint8_v6.npy",#"assets/nrw_test_area_mapping.npy", #"assets/mapping_V2_part_50.npy",
                #         "feature_mmap_path": "indexes/features",
                #         "feature_mmap_dtype": "uint8",
                #         "size_dataset": 262_563_993, 
                #         "features_inmemory": True,#True, #False, for mmap
                #         "non_rare_idxs": "auto",
                #         "non_rare_idxs_num": 100_000,#30_000,
                #         "nfeat":32,
                #         "seed": 42,
                #         "kdt_search":{
                #                 "index_file": None,#"assets/feature_subsets.npy",
                #                 "index_dir": "indexes/laion_d8",
                #                 "leafsize": 4500,
                #                 "dtype":"uint8",
                #                 "build_inmemory":True,
                #                 "fidx_cfg": {"nfeat":8,"nind":32},#{"nfeat": 4,"nind":50},
                #         },
                #         "kdt_textsearch":{
                #                 "type": "kdtree",
                #                 "index_file": None,#"assets/feature_subsets.npy",
                #                 "index_dir": "indexes/laion_text",
                #                 "leafsize": 4500,
                #                 "dtype":"uint8",
                #                 "inmemory":False,
                #                 "build_inmemory":True,
                #                 "fidx_cfg": {"nfeat":32,"nind":1},
                #                 "stop_leaves": 500,
                #         },
                #         # "kdt_textsearch":{
                #         #         "type": "faiss",	
                #         #         "index_dir": "indexes/laion_text_faiss",
                #         #         "index_file": "laion_flat_index.index",
                #         # },
                #         # "kdt_textsearch":{
                #         #         "type": "treeset",	
                #         # },

                #         "text_searcher":{
                #                 "model_weights_path":"assets/clip_weights_v6.pth",
                #                 "model_type": "CLIP",
                #                 "clip_cfg": {"model":"ViT-B/32","device":"cpu","train":False,"custom_head":True,"embed_dim":32,"hidden_dim":8192},
                #         },
                #         "searcher": {
                #                 "db-maxevals0.5-demo": {
                #                         "display_name": "Decisionbranches Demo",
                #                         "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":False,"min_pts":10},
                #                         "njobs": 1,
                #                         "dtype":"float64",
                #                         "min_box_size": None,
                #                 },
                #                 "db-maxevals0.5-min2": {
                #                         "display_name": "Decisionbranches Demo",
                #                         "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":False,"min_pts":10},
                #                         "njobs": 1,
                #                         "dtype":"float64",
                #                         "min_box_size": 2,
                #                 },
                #                 "db-maxevals0.5-topDown": {
                #                         "display_name": "Decisionbranches Demo",
                #                         "db_cfg":{"max_nbox":30,"top_down":True,"max_evals":0.5,"stop_infinite":False,"postTree":False,"min_pts":10},
                #                         "njobs": 1,
                #                         "dtype":"float64",
                #                         "min_box_size": None,
                #                 },
                #                 "db-maxevals0.5-postTree": {
                #                         "display_name": "Decisionbranches Demo",
                #                         "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":True,"min_pts":10},
                #                         "njobs": 1,
                #                         "dtype":"float64",
                #                         "min_box_size": None,
                #                 },
                #                 "db-maxevals1.0-demo": {
                #                         "display_name": "Decisionbranches Demo",
                #                         "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":"all","stop_infinite":False,"postTree":False,"min_pts":10},
                #                         "njobs": 1,
                #                         "dtype":"float64",
                #                         "min_box_size": None,
                #                 },
                #                 "db-maxevals0.5-min2-stop": {
                #                         "display_name": "Decisionbranches Demo",
                #                         "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":True,"postTree":False,"min_pts":10},
                #                         "njobs": 1,
                #                         "dtype":"float64",
                #                         "min_box_size": 2,
                #                 },
                #                 "db-maxevals1.0-demo-stop": {
                #                         "display_name": "Decisionbranches Demo",
                #                         "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":"all","stop_infinite":True,"postTree":False,"min_pts":10},
                #                         "njobs": 1,
                #                         "dtype":"float64",
                #                         "min_box_size": None,
                #                 },
                #                 "db-maxevals1.0-postTree-stop": {
                #                         "display_name": "Decisionbranches Demo",
                #                         "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":"all","stop_infinite":True,"postTree":True,"min_pts":10},
                #                         "njobs": 1,
                #                         "dtype":"float64",
                #                         "min_box_size": None,
                #                 },
                #                 "ens-small-stop": {
                #                         "ens_nestimators":11,
                #                         "db_cfg":{"max_nbox":5,"top_down":False,"max_evals":"auto","stop_infinite":True,"postTree":False},
                #                         "njobs": None,
                #                         "display_name": "Decisionbranches Ensemble",
                #                         "dtype":"float64",
                #                 },
                #                 "ens-small": {
                #                         "ens_nestimators":11,
                #                         "db_cfg":{"max_nbox":5,"top_down":False,"max_evals":"auto","stop_infinite":False,"postTree":False},
                #                         "njobs": None,
                #                         "display_name": "Decisionbranches Ensemble",
                #                         "dtype":"float64",
                #                 },
                #                 "ens": {
                #                         "ens_nestimators":25,
                #                         "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":False},
                #                         "njobs": None,
                #                         "display_name": "Decisionbranches Ensemble (25 trees)",
                #                         "dtype":"float64",
                #                 },
                #                 "dtree": {
                #                         "dtree_cfg":{},
                #                         "display_name": "Decision Tree",
                #                         "dtype":"float32",

                #                 },
                #                 "rf": {
                #                         "rf_cfg": {"n_estimators":25},
                #                         "display_name": "Random Forest (25t)",
                #                         "dtype":"float32",
                #                 },
                #                 "nn":{
                #                         "nn_k": 1000,
                #                         "display_name": "Nearest Neighbor Search (k=1000)",
                #                 },
                #                 "boxnet1":{
                #                     "display_name": "HyperNN",
                #                     "nboxes":150,
                #                     "scaling":True,
                #                     "dtype": "float32",
                #                     "cfg": {"training_epochs":1000,
                #                             "verbose":True,"l1_reg":0,
                #                             "patience_early_stopping":500,"l2_reg":0,
                #                             "learning_rate":1e-1,
                #                             "num_threads":10,
                #                             "alpha_tau_decay_step":25,
                #                             "box_pruning_step":250,
                #                             },
                #                 },
                #         }

                #   },

                #  "laion_262m_d4": {
                #         "display_name": "laion_262m",
                #         "feature_file": "assets/laion_features_d32_uint8_v6.npy",#"assets/nrw_test_area_mapping.npy", #"assets/mapping_V2_part_50.npy",
                #         "feature_mmap_path": "indexes/features",
                #         "feature_mmap_dtype": "uint8",
                #         "size_dataset": 262_563_993, 
                #         "features_inmemory": True,#True, #False, for mmap
                #         "non_rare_idxs": "auto",
                #         "non_rare_idxs_num": 100_000,#30_000,
                #         "nfeat":32,
                #         "seed": 42,
                #         "kdt_search":{
                #                 "index_file": None,#"assets/feature_subsets.npy",
                #                 "index_dir": "indexes/laion",
                #                 "leafsize": 4500,
                #                 "dtype":"uint8",
                #                 "build_inmemory":True,
                #                 "fidx_cfg": {"nfeat":4,"nind":50},#{"nfeat": 4,"nind":50},
                #         },
                #         "kdt_textsearch":{
                #                 "type": "kdtree",
                #                 "index_file": None,#"assets/feature_subsets.npy",
                #                 "index_dir": "indexes/laion_text",
                #                 "leafsize": 4500,
                #                 "dtype":"uint8",
                #                 "inmemory":False,
                #                 "build_inmemory":True,
                #                 "fidx_cfg": {"nfeat":32,"nind":1},
                #                 "stop_leaves": 500,
                #         },
                #         # "kdt_textsearch":{
                #         #         "type": "faiss",	
                #         #         "index_dir": "indexes/laion_text_faiss",
                #         #         "index_file": "laion_flat_index.index",
                #         # },
                #         # "kdt_textsearch":{
                #         #         "type": "treeset",	
                #         # },

                #         "text_searcher":{
                #                 "model_weights_path":"assets/clip_weights_v6.pth",
                #                 "model_type": "CLIP",
                #                 "clip_cfg": {"model":"ViT-B/32","device":"cpu","train":False,"custom_head":True,"embed_dim":32,"hidden_dim":8192},
                #         },
                #         "searcher": {
                #                 "db-maxevals0.5-demo": {
                #                         "display_name": "Decisionbranches Demo",
                #                         "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":False,"min_pts":50},
                #                         "njobs": 1,
                #                         "dtype":"float64",
                #                         "min_box_size": None,
                #                 },
                #                 "db-maxevals0.5-min2": {
                #                         "display_name": "Decisionbranches Demo",
                #                         "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":False,"min_pts":50},
                #                         "njobs": 1,
                #                         "dtype":"float64",
                #                         "min_box_size": 2,
                #                 },
                #                 "db-maxevals0.5-topDown": {
                #                         "display_name": "Decisionbranches Demo",
                #                         "db_cfg":{"max_nbox":30,"top_down":True,"max_evals":0.5,"stop_infinite":False,"postTree":False,"min_pts":50},
                #                         "njobs": 1,
                #                         "dtype":"float64",
                #                         "min_box_size": None,
                #                 },
                #                 "db-maxevals0.5-postTree": {
                #                         "display_name": "Decisionbranches Demo",
                #                         "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":True,"min_pts":50},
                #                         "njobs": 1,
                #                         "dtype":"float64",
                #                         "min_box_size": None,
                #                 },
                #                 "db-maxevals1.0-demo": {
                #                         "display_name": "Decisionbranches Demo",
                #                         "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":"all","stop_infinite":False,"postTree":False,"min_pts":50},
                #                         "njobs": 1,
                #                         "dtype":"float64",
                #                         "min_box_size": None,
                #                 },
                #                 "db-maxevals0.5-min2-stop": {
                #                         "display_name": "Decisionbranches Demo",
                #                         "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":True,"postTree":False,"min_pts":50},
                #                         "njobs": 1,
                #                         "dtype":"float64",
                #                         "min_box_size": 2,
                #                 },
                #                 "db-maxevals1.0-topDown-stop": {
                #                         "display_name": "Decisionbranches Demo",
                #                         "db_cfg":{"max_nbox":30,"top_down":True,"max_evals":"all","stop_infinite":True,"postTree":False,"min_pts":50},
                #                         "njobs": 1,
                #                         "dtype":"float64",
                #                         "min_box_size": None,
                #                 },
                #                 "db-maxevals0.5-topDown-stop": {
                #                         "display_name": "Decisionbranches Demo",
                #                         "db_cfg":{"max_nbox":30,"top_down":True,"max_evals":0.5,"stop_infinite":True,"postTree":False,"min_pts":50},
                #                         "njobs": 1,
                #                         "dtype":"float64",
                #                         "min_box_size": None,
                #                 },
                #                 "db-maxevals1.0-demo-stop": {
                #                         "display_name": "Decisionbranches Demo",
                #                         "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":"all","stop_infinite":True,"postTree":False,"min_pts":50},
                #                         "njobs": 1,
                #                         "dtype":"float64",
                #                         "min_box_size": None,
                #                 },
                #                 "db-maxevals1.0-postTree-stop": {
                #                         "display_name": "Decisionbranches Demo",
                #                         "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":"all","stop_infinite":True,"postTree":True,"min_pts":50},
                #                         "njobs": 1,
                #                         "dtype":"float64",
                #                         "min_box_size": None,
                #                 },
                #                 "db-maxevals0.5-postTree-stop": {
                #                         "display_name": "Decisionbranches Demo",
                #                         "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":True,"postTree":True,"min_pts":50},
                #                         "njobs": 1,
                #                         "dtype":"float64",
                #                         "min_box_size": None,
                #                 },
                #                 "ens-small-stop": {
                #                         "ens_nestimators":11,
                #                         "db_cfg":{"max_nbox":5,"top_down":False,"max_evals":"auto","stop_infinite":True,"postTree":False},
                #                         "njobs": None,
                #                         "display_name": "Decisionbranches Ensemble",
                #                         "dtype":"float64",
                #                 },
                #                 "ens-small": {
                #                         "ens_nestimators":11,
                #                         "db_cfg":{"max_nbox":5,"top_down":False,"max_evals":"auto","stop_infinite":False,"postTree":False},
                #                         "njobs": None,
                #                         "display_name": "Decisionbranches Ensemble",
                #                         "dtype":"float64",
                #                 },
                #                 "ens": {
                #                         "ens_nestimators":25,
                #                         "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":False},
                #                         "njobs": None,
                #                         "display_name": "Decisionbranches Ensemble (25 trees)",
                #                         "dtype":"float64",
                #                 },
                #                 "dtree": {
                #                         "dtree_cfg":{},
                #                         "display_name": "Decision Tree",
                #                         "dtype":"float32",

                #                 },
                #                 "rf": {
                #                         "rf_cfg": {"n_estimators":25},
                #                         "display_name": "Random Forest (25t)",
                #                         "dtype":"float32",
                #                 },
                #                 "nn":{
                #                         "nn_k": 1000,
                #                         "display_name": "Nearest Neighbor Search (k=1000)",
                #                 },
                #                 "boxnet1":{
                #                     "display_name": "HyperNN",
                #                     "nboxes":150,
                #                     "scaling":True,
                #                     "dtype": "float32",
                #                     "cfg": {"training_epochs":1000,
                #                             "verbose":True,"l1_reg":0,
                #                             "patience_early_stopping":500,"l2_reg":0,
                #                             "learning_rate":1e-1,
                #                             "num_threads":10,
                #                             "alpha_tau_decay_step":25,
                #                             "box_pruning_step":250,
                #                             },
                #                 },
                #         }

                #   },


                # "laion_262m": {
                #         "display_name": "laion_262m",
                #         "feature_file": "assets/laion_features_d32_uint8_v6.npy",#"assets/nrw_test_area_mapping.npy", #"assets/mapping_V2_part_50.npy",
                #         "feature_mmap_path": "indexes/features",
                #         "feature_mmap_dtype": "uint8",
                #         "size_dataset": 262_563_993, 
                #         "features_inmemory": True,#True, #False, for mmap
                #         "non_rare_idxs": "auto",
                #         "non_rare_idxs_num": 100_000,#30_000,
                #         "nfeat":32,
                #         "seed": 42,
                #         "kdt_search":{
                #                 "index_file": None,#"assets/feature_subsets.npy",
                #                 "index_dir": "indexes/laion_d3",
                #                 "leafsize": 4500,
                #                 "dtype":"uint8",
                #                 "build_inmemory":True,
                #                 "fidx_cfg": {"nfeat":3,"nind":100},#{"nfeat": 4,"nind":50},
                #         },
                #         "kdt_textsearch":{
                #                 "type": "kdtree",
                #                 "index_file": None,#"assets/feature_subsets.npy",
                #                 "index_dir": "indexes/laion_text",
                #                 "leafsize": 4500,
                #                 "dtype":"uint8",
                #                 "inmemory":False,
                #                 "build_inmemory":True,
                #                 "fidx_cfg": {"nfeat":32,"nind":1},
                #                 "stop_leaves": 500,
                #         },
                #         # "kdt_textsearch":{
                #         #         "type": "faiss",	
                #         #         "index_dir": "indexes/laion_text_faiss",
                #         #         "index_file": "laion_flat_index.index",
                #         # },
                #         # "kdt_textsearch":{
                #         #         "type": "treeset",	
                #         # },

                #         "text_searcher":{
                #                 "model_weights_path":"assets/clip_weights_v6.pth",
                #                 "model_type": "CLIP",
                #                 "clip_cfg": {"model":"ViT-B/32","device":"cpu","train":False,"custom_head":True,"embed_dim":32,"hidden_dim":8192},
                #         },
                #         "searcher": {
                #                 "db-maxevals0.5-demo": {
                #                         "display_name": "Decisionbranches Demo",
                #                         "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":False,"min_pts":10},
                #                         "njobs": 1,
                #                         "dtype":"float64",
                #                         "min_box_size": None,
                #                 },
                #                 "db-maxevals0.5-min2": {
                #                         "display_name": "Decisionbranches Demo",
                #                         "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":False,"min_pts":10},
                #                         "njobs": 1,
                #                         "dtype":"float64",
                #                         "min_box_size": 2,
                #                 },
                #                 "db-maxevals0.5-topDown": {
                #                         "display_name": "Decisionbranches Demo",
                #                         "db_cfg":{"max_nbox":30,"top_down":True,"max_evals":0.5,"stop_infinite":False,"postTree":False,"min_pts":10},
                #                         "njobs": 1,
                #                         "dtype":"float64",
                #                         "min_box_size": None,
                #                 },
                #                 "db-maxevals0.5-postTree": {
                #                         "display_name": "Decisionbranches Demo",
                #                         "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":True,"min_pts":10},
                #                         "njobs": 1,
                #                         "dtype":"float64",
                #                         "min_box_size": None,
                #                 },
                #                 "db-maxevals1.0-demo": {
                #                         "display_name": "Decisionbranches Demo",
                #                         "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":"all","stop_infinite":False,"postTree":False,"min_pts":10},
                #                         "njobs": 1,
                #                         "dtype":"float64",
                #                         "min_box_size": None,
                #                 },
                #                 "db-maxevals0.5-min2-stop": {
                #                         "display_name": "Decisionbranches Demo",
                #                         "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":True,"postTree":False,"min_pts":10},
                #                         "njobs": 1,
                #                         "dtype":"float64",
                #                         "min_box_size": 2,
                #                 },
                #                 "db-maxevals1.0-demo-stop": {
                #                         "display_name": "Decisionbranches Demo",
                #                         "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":"all","stop_infinite":True,"postTree":False,"min_pts":10},
                #                         "njobs": 1,
                #                         "dtype":"float64",
                #                         "min_box_size": None,
                #                 },
                #                 "db-maxevals1.0-postTree-stop": {
                #                         "display_name": "Decisionbranches Demo",
                #                         "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":"all","stop_infinite":True,"postTree":True,"min_pts":10},
                #                         "njobs": 1,
                #                         "dtype":"float64",
                #                         "min_box_size": None,
                #                 },
                #                 "ens-small-stop": {
                #                         "ens_nestimators":11,
                #                         "db_cfg":{"max_nbox":5,"top_down":False,"max_evals":"auto","stop_infinite":True,"postTree":False},
                #                         "njobs": None,
                #                         "display_name": "Decisionbranches Ensemble",
                #                         "dtype":"float64",
                #                 },
                #                 "ens-small": {
                #                         "ens_nestimators":11,
                #                         "db_cfg":{"max_nbox":5,"top_down":False,"max_evals":"auto","stop_infinite":False,"postTree":False},
                #                         "njobs": None,
                #                         "display_name": "Decisionbranches Ensemble",
                #                         "dtype":"float64",
                #                 },
                #                 "ens": {
                #                         "ens_nestimators":25,
                #                         "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":False},
                #                         "njobs": None,
                #                         "display_name": "Decisionbranches Ensemble (25 trees)",
                #                         "dtype":"float64",
                #                 },
                #                 "dtree": {
                #                         "dtree_cfg":{},
                #                         "display_name": "Decision Tree",
                #                         "dtype":"float32",

                #                 },
                #                 "rf": {
                #                         "rf_cfg": {"n_estimators":25},
                #                         "display_name": "Random Forest (25t)",
                #                         "dtype":"float32",
                #                 },
                #                 "nn":{
                #                         "nn_k": 1000,
                #                         "display_name": "Nearest Neighbor Search (k=1000)",
                #                 },
                #                 "boxnet1":{
                #                     "display_name": "HyperNN",
                #                     "nboxes":150,
                #                     "scaling":True,
                #                     "dtype": "float32",
                #                     "cfg": {"training_epochs":1000,
                #                             "verbose":True,"l1_reg":0,
                #                             "patience_early_stopping":500,"l2_reg":0,
                #                             "learning_rate":1e-1,
                #                             "num_threads":10,
                #                             "alpha_tau_decay_step":25,
                #                             "box_pruning_step":250,
                #                             },
                #                 },
                #         }

                #   },

                "laion_1m": {
                        "display_name": "laion_1M_subset",
                        "feature_file": "assets/laion_features_d32_uint8_v6_sub_1M.npy",#"assets/nrw_test_area_mapping.npy", #"assets/mapping_V2_part_50.npy",
                        "feature_mmap_path": "indexes/features",
                        "feature_mmap_dtype": "uint8",
                        "size_dataset": 1_000_000,
                        "features_inmemory": True,#True, #False, for mmap
                        "non_rare_idxs": "auto",
                        "non_rare_idxs_num": 10_000,#30_000,
                        "nfeat":32,
                        "seed": 42,
                        "kdt_search":{
                                "index_file": None,#"assets/feature_subsets.npy",
                                "index_dir": "indexes/laion_1M_sub",
                                "leafsize": 4500,
                                "dtype":"uint8",
                                "build_inmemory":True,
                                "fidx_cfg": {"nfeat": 4,"nind":32},#{"nfeat":"variable","cfg":{}},#{"nfeat": 4,"nind":50},
                        },
                        # "kdt_textsearch":{
                        #         "type": "faiss",	
                        #         "index_dir": "indexes/laion_1m_text_faiss",
                        #         "index_file": "laion_flat_index.index",
                        # },
                        "kdt_textsearch":{
                                "type": "kdtree",
                                "index_file": None,#"assets/feature_subsets.npy",
                                "index_dir": "indexes/laion_1M_sub_text",
                                "leafsize": 4500,
                                "dtype":"uint8",
                                "inmemory":False,
                                "build_inmemory":True,
                                # "fidx_cfg": {"nfeat":32,"nind":1},
                        },
                        "text_searcher":{
                                "model_weights_path":"assets/clip_weights_v6.pth",
                                "model_type": "CLIP",
                                "clip_cfg": {"model":"ViT-B/32","device":"cpu","train":False,"custom_head":True,"embed_dim":32,"hidden_dim":8192},
                        },
                        "searcher": {
                               "db-maxevals0.5-demo": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":False,"min_pts":10},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "db-maxevals0.5-min2": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":False,"min_pts":10},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": 2,
                                },
                                "db-maxevals0.5-topDown": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":True,"max_evals":0.5,"stop_infinite":False,"postTree":False,"min_pts":10},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "db-maxevals0.5-postTree": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":True,"min_pts":10},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "db-maxevals1.0-demo": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":"all","stop_infinite":False,"postTree":False,"min_pts":10},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "db-maxevals0.5-min2-stop": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":True,"postTree":False,"min_pts":10},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": 2,
                                },
                                "db-maxevals1.0-demo-stop": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":"all","stop_infinite":True,"postTree":False,"min_pts":10},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "db-maxevals1.0-postTree-stop": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":"all","stop_infinite":True,"postTree":True,"min_pts":10},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "ens-small-stop": {
                                        "ens_nestimators":11,
                                        "db_cfg":{"max_nbox":5,"top_down":False,"max_evals":"auto","stop_infinite":True,"postTree":False},
                                        "njobs": None,
                                        "display_name": "Decisionbranches Ensemble",
                                        "dtype":"float64",
                                },
                                "ens-small": {
                                        "ens_nestimators":11,
                                        "db_cfg":{"max_nbox":5,"top_down":False,"max_evals":"auto","stop_infinite":False,"postTree":False},
                                        "njobs": None,
                                        "display_name": "Decisionbranches Ensemble",
                                        "dtype":"float64",
                                },
                                "ens": {
                                        "ens_nestimators":25,
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":False},
                                        "njobs": None,
                                        "display_name": "Decisionbranches Ensemble (25 trees)",
                                        "dtype":"float64",
                                },
                                "dtree": {
                                        "dtree_cfg":{},
                                        "display_name": "Decision Tree",
                                        "dtype":"float32",

                                },
                                "rf": {
                                        "rf_cfg": {"n_estimators":25},
                                        "display_name": "Random Forest (25t)",
                                        "dtype":"float32",
                                },
                                "nn":{
                                        "nn_k": 1000,
                                        "display_name": "Nearest Neighbor Search (k=1000)",
                                },
                                "boxnet1":{
                                    "display_name": "HyperNN",
                                    "nboxes":150,
                                    "scaling":True,
                                    "dtype": "float32",
                                    "cfg": {"training_epochs":1000,
                                            "verbose":True,"l1_reg":0,
                                            "patience_early_stopping":500,"l2_reg":0,
                                            "learning_rate":1e-1,
                                            "num_threads":10,
                                            "alpha_tau_decay_step":25,
                                            "box_pruning_step":250,
                                            },
                                },
                        }

                  },

                "laion_1m_var": {
                        "display_name": "laion_1M_subset",
                        "feature_file": "assets/laion_features_d32_uint8_v6_sub_1M.npy",#"assets/nrw_test_area_mapping.npy", #"assets/mapping_V2_part_50.npy",
                        "feature_mmap_path": "indexes/features",
                        "feature_mmap_dtype": "uint8",
                        "size_dataset": 1_000_000,
                        "features_inmemory": True,#True, #False, for mmap
                        "non_rare_idxs": "auto",
                        "non_rare_idxs_num": 10_000,#30_000,
                        "nfeat":32,
                        "seed": 42,
                        "kdt_search":{
                                "index_file": None,#"assets/feature_subsets.npy",
                                "index_dir": "indexes/laion_1M_sub_var",
                                "leafsize": 4500,
                                "dtype":"uint8",
                                "build_inmemory":True,
                                "fidx_cfg": {"nfeat": "variable","cfg":{4:32,6:24,8:16}},#{"nfeat":"variable","cfg":{}},#{"nfeat": 4,"nind":50},
                        },
                        # "kdt_textsearch":{
                        #         "type": "faiss",	
                        #         "index_dir": "indexes/laion_1m_text_faiss",
                        #         "index_file": "laion_flat_index.index",
                        # },
                        "kdt_textsearch":{
                                "type": "kdtree",
                                "index_file": None,#"assets/feature_subsets.npy",
                                "index_dir": "indexes/laion_1M_sub_text",
                                "leafsize": 4500,
                                "dtype":"uint8",
                                "inmemory":False,
                                "build_inmemory":True,
                                # "fidx_cfg": {"nfeat":32,"nind":1},
                        },
                        "text_searcher":{
                                "model_weights_path":"assets/clip_weights_v6.pth",
                                "model_type": "CLIP",
                                "clip_cfg": {"model":"ViT-B/32","device":"cpu","train":False,"custom_head":True,"embed_dim":32,"hidden_dim":8192},
                        },
                        "searcher": {
                               "db-maxevals0.5-demo": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":False,"min_pts":10},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "db-maxevals0.5-min2": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":False,"min_pts":10},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": 2,
                                },
                                "db-maxevals0.5-topDown": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":True,"max_evals":0.5,"stop_infinite":False,"postTree":False,"min_pts":10},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "db-maxevals0.5-postTree": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":True,"min_pts":10},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "db-maxevals1.0-demo": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":"all","stop_infinite":False,"postTree":False,"min_pts":10},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "db-maxevals0.5-min2-stop": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":True,"postTree":False,"min_pts":10},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": 2,
                                },
                                "db-maxevals1.0-demo-stop": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":"all","stop_infinite":True,"postTree":False,"min_pts":10},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "db-maxevals1.0-postTree-stop": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":"all","stop_infinite":True,"postTree":True,"min_pts":10},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "ens-small-stop": {
                                        "ens_nestimators":11,
                                        "db_cfg":{"max_nbox":5,"top_down":False,"max_evals":"auto","stop_infinite":True,"postTree":False},
                                        "njobs": None,
                                        "display_name": "Decisionbranches Ensemble",
                                        "dtype":"float64",
                                },
                                "ens-small": {
                                        "ens_nestimators":11,
                                        "db_cfg":{"max_nbox":5,"top_down":False,"max_evals":"auto","stop_infinite":False,"postTree":False},
                                        "njobs": None,
                                        "display_name": "Decisionbranches Ensemble",
                                        "dtype":"float64",
                                },
                                "ens": {
                                        "ens_nestimators":25,
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":False},
                                        "njobs": None,
                                        "display_name": "Decisionbranches Ensemble (25 trees)",
                                        "dtype":"float64",
                                },
                                "dtree": {
                                        "dtree_cfg":{},
                                        "display_name": "Decision Tree",
                                        "dtype":"float32",

                                },
                                "rf": {
                                        "rf_cfg": {"n_estimators":25},
                                        "display_name": "Random Forest (25t)",
                                        "dtype":"float32",
                                },
                                "nn":{
                                        "nn_k": 1000,
                                        "display_name": "Nearest Neighbor Search (k=1000)",
                                },
                                # "boxnet1":{
                                #     "display_name": "HyperNN",
                                #     "nboxes":150,
                                #     "scaling":True,
                                #     "dtype": "float32",
                                #     "cfg": {"training_epochs":1000,
                                #             "verbose":True,"l1_reg":0,
                                #             "patience_early_stopping":500,"l2_reg":0,
                                #             "learning_rate":1e-1,
                                #             "num_threads":10,
                                #             "alpha_tau_decay_step":25,
                                #             "box_pruning_step":250,
                                #             },
                                # },
                        }

                  },

                        "laion_1m_d8": {
                        "display_name": "laion_1M_subset",
                        "feature_file": "assets/laion_features_d32_uint8_v6_sub_1M.npy",#"assets/nrw_test_area_mapping.npy", #"assets/mapping_V2_part_50.npy",
                        "feature_mmap_path": "indexes/features",
                        "feature_mmap_dtype": "uint8",
                        "size_dataset": 1_000_000,
                        "features_inmemory": True,#True, #False, for mmap
                        "non_rare_idxs": "auto",
                        "non_rare_idxs_num": 10_000,#30_000,
                        "nfeat":32,
                        "seed": 42,
                        "kdt_search":{
                                "index_file": None,#"assets/feature_subsets.npy",
                                "index_dir": "indexes/laion_1M_sub_d8",
                                "leafsize": 4500,
                                "dtype":"uint8",
                                "build_inmemory":True,
                                "fidx_cfg": {"nfeat":8,"nind":32},#{"nfeat": 4,"nind":50},
                        },
                        # "kdt_textsearch":{
                        #         "type": "faiss",	
                        #         "index_dir": "indexes/laion_1m_text_faiss",
                        #         "index_file": "laion_flat_index.index",
                        # },
                        "kdt_textsearch":{
                                "type": "kdtree",
                                "index_file": None,#"assets/feature_subsets.npy",
                                "index_dir": "indexes/laion_1M_sub_text",
                                "leafsize": 4500,
                                "dtype":"uint8",
                                "inmemory":False,
                                "build_inmemory":True,
                                # "fidx_cfg": {"nfeat":32,"nind":1},
                        },
                        "text_searcher":{
                                "model_weights_path":"assets/clip_weights_v6.pth",
                                "model_type": "CLIP",
                                "clip_cfg": {"model":"ViT-B/32","device":"cpu","train":False,"custom_head":True,"embed_dim":32,"hidden_dim":8192},
                        },
                        "searcher": {
                               "db-maxevals0.5-demo": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":False,"min_pts":10},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "db-maxevals0.5-min2": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":False,"min_pts":10},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": 2,
                                },
                                "db-maxevals0.5-topDown": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":True,"max_evals":0.5,"stop_infinite":False,"postTree":False,"min_pts":10},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "db-maxevals0.5-postTree": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":True,"min_pts":10},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "db-maxevals1.0-demo": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":"all","stop_infinite":False,"postTree":False,"min_pts":10},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "db-maxevals0.5-min2-stop": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":True,"postTree":False,"min_pts":10},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": 2,
                                },
                                "db-maxevals1.0-demo-stop": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":"all","stop_infinite":True,"postTree":False,"min_pts":10},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "db-maxevals1.0-postTree-stop": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":"all","stop_infinite":True,"postTree":True,"min_pts":10},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "ens-small-stop": {
                                        "ens_nestimators":11,
                                        "db_cfg":{"max_nbox":5,"top_down":False,"max_evals":"auto","stop_infinite":True,"postTree":False},
                                        "njobs": None,
                                        "display_name": "Decisionbranches Ensemble",
                                        "dtype":"float64",
                                },
                                "ens-small": {
                                        "ens_nestimators":11,
                                        "db_cfg":{"max_nbox":5,"top_down":False,"max_evals":"auto","stop_infinite":False,"postTree":False},
                                        "njobs": None,
                                        "display_name": "Decisionbranches Ensemble",
                                        "dtype":"float64",
                                },
                                "ens": {
                                        "ens_nestimators":25,
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":False},
                                        "njobs": None,
                                        "display_name": "Decisionbranches Ensemble (25 trees)",
                                        "dtype":"float64",
                                },
                                "dtree": {
                                        "dtree_cfg":{},
                                        "display_name": "Decision Tree",
                                        "dtype":"float32",

                                },
                                "rf": {
                                        "rf_cfg": {"n_estimators":25},
                                        "display_name": "Random Forest (25t)",
                                        "dtype":"float32",
                                },
                                "nn":{
                                        "nn_k": 1000,
                                        "display_name": "Nearest Neighbor Search (k=1000)",
                                },
                                "boxnet1":{
                                    "display_name": "HyperNN",
                                    "nboxes":150,
                                    "scaling":True,
                                    "dtype": "float32",
                                    "cfg": {"training_epochs":1000,
                                            "verbose":True,"l1_reg":0,
                                            "patience_early_stopping":500,"l2_reg":0,
                                            "learning_rate":1e-1,
                                            "num_threads":10,
                                            "alpha_tau_decay_step":25,
                                            "box_pruning_step":250,
                                            },
                                },
                        }

                  },

        #        "laion_262m_full": {
        #                 "display_name": "laion_262m_full",
        #                 "feature_file": "assets/laion_features_d32_uint8_v6.npy",#"assets/nrw_test_area_mapping.npy", #"assets/mapping_V2_part_50.npy",
        #                 "feature_mmap_path": "indexes/features",
        #                 "feature_mmap_dtype": "uint8",
        #                 "size_dataset": 262_563_993, 
        #                 "features_inmemory": True,#True, #False, for mmap
        #                 "non_rare_idxs": "auto",
        #                 "non_rare_idxs_num": 20_000,#30_000,
        #                 "nfeat":32,
        #                 "seed": 42,
        #                 "kdt_search":{
        #                         "index_file": None,#"assets/feature_subsets.npy",
        #                         "index_dir": "indexes/laion_d3",
        #                         "leafsize": 4500,
        #                         "dtype":"uint8",
        #                         "build_inmemory":True,
        #                         "fidx_cfg": {"nfeat":3,"nind":100},#{"nfeat": 4,"nind":50},
        #                 },
        #                 "kdt_textsearch":{
        #                         "type": "kdtree",
        #                         "index_file": None,#"assets/feature_subsets.npy",
        #                         "index_dir": "indexes/laion_text",
        #                         "leafsize": 4500,
        #                         "dtype":"uint8",
        #                         "inmemory":False,
        #                         "build_inmemory":True,
        #                         "fidx_cfg": {"nfeat":32,"nind":1},
        #                         "stop_leaves": None,
        #                 },
        #                 # "kdt_textsearch":{
        #                 #         "type": "faiss",	
        #                 #         "index_dir": "indexes/laion_text_faiss",
        #                 #         "index_file": "laion_flat_index.index",
        #                 # },
        #                 # "kdt_textsearch":{
        #                 #         "type": "treeset",	
        #                 # },

        #                 "text_searcher":{
        #                         "model_weights_path":"assets/clip_weights_v6.pth",
        #                         "model_type": "CLIP",
        #                         "clip_cfg": {"model":"ViT-B/32","device":"cpu","train":False,"custom_head":True,"embed_dim":32,"hidden_dim":8192},
        #                 },
        #                 "searcher": {
        #                         "db-maxevals0.5-demo": {
        #                                 "display_name": "Decisionbranches Demo",
        #                                 "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":False,"min_pts":10},
        #                                 "njobs": 1,
        #                                 "dtype":"float64",
        #                                 "min_box_size": None,
        #                         },
        #                         "db-maxevals1.0-demo": {
        #                                 "display_name": "Decisionbranches Demo",
        #                                 "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":"all","stop_infinite":False,"postTree":False,"min_pts":10},
        #                                 "njobs": 1,
        #                                 "dtype":"float64",
        #                                 "min_box_size": None,
        #                         },
        #                         "ens-small": {
        #                                 "ens_nestimators":11,
        #                                 "db_cfg":{"max_nbox":5,"top_down":False,"max_evals":"auto","stop_infinite":False,"postTree":False},
        #                                 "njobs": None,
        #                                 "display_name": "Decisionbranches Ensemble",
        #                                 "dtype":"float64",
        #                         },
        #                         "ens": {
        #                                 "ens_nestimators":25,
        #                                 "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":False},
        #                                 "njobs": None,
        #                                 "display_name": "Decisionbranches Ensemble (25 trees)",
        #                                 "dtype":"float64",
        #                         },
        #                         "dtree": {
        #                                 "dtree_cfg":{},
        #                                 "display_name": "Decision Tree",
        #                                 "dtype":"float32",

        #                         },
        #                         "rf": {
        #                                 "rf_cfg": {"n_estimators":25},
        #                                 "display_name": "Random Forest (25t)",
        #                                 "dtype":"float32",
        #                         },
        #                         "nn":{
        #                                 "nn_k": 1000,
        #                                 "display_name": "Nearest Neighbor Search (k=1000)",
        #                         },
        #                         "boxnet1":{
        #                             "display_name": "HyperNN",
        #                             "nboxes":150,
        #                             "scaling":True,
        #                             "dtype": "float32",
        #                             "cfg": {"training_epochs":1000,
        #                                     "verbose":True,"l1_reg":0,
        #                                     "patience_early_stopping":500,"l2_reg":0,
        #                                     "learning_rate":1e-1,
        #                                     "num_threads":10,
        #                                     "alpha_tau_decay_step":25,
        #                                     "box_pruning_step":250,
        #                                     },
        #                         },
        #                 }

        #           },

        # "laion_1M_subset_float32": {
        #                 "display_name": "laion_1M_subset_float32",
        #                 "feature_file": "assets/laion_features_d32_float32_v6_sub_1M.npy",#"assets/nrw_test_area_mapping.npy", #"assets/mapping_V2_part_50.npy",
        #                 "feature_mmap_path": "indexes/features",
        #                 "feature_mmap_dtype": "float32",
        #                 "size_dataset": 1_000_000,
        #                 "features_inmemory": True,#True, #False, for mmap
        #                 "non_rare_idxs": "auto",
        #                 "non_rare_idxs_num": 10_000,#30_000,
        #                 "nfeat":32,
        #                 "seed": 42,
        #                 "kdt_search":{
        #                         "index_file": None,#"assets/feature_subsets.npy",
        #                         "index_dir": "indexes/laion_1M_sub_float32",
        #                         "leafsize": 4500,
        #                         "dtype":"float64",
        #                         "build_inmemory":True,
        #                         "fidx_cfg": {"nfeat":4,"nind":32},#{"nfeat": 4,"nind":50},
        #                 },
        #                 "kdt_textsearch":{
        #                         "index_file": None,#"assets/feature_subsets.npy",
        #                         "index_dir": "indexes/laion_1M_sub_float32_text",
        #                         "leafsize": 4500,
        #                         "dtype":"float64",
        #                         "inmemory":False,
        #                         "build_inmemory":True,
        #                         # "fidx_cfg": {"nfeat":32,"nind":1},
        #                 },
        #                 "text_searcher":{
        #                         "model_weights_path":"assets/clip_weights_v6.pth",
        #                         "model_type": "CLIP",
        #                         "clip_cfg": {"model":"ViT-B/32","device":"cpu","train":False,"custom_head":True,"embed_dim":32,"hidden_dim":8192},
        #                 },
        #                 "searcher": {
        #                         "db-maxevals0.5-demo": {
        #                                 "display_name": "Decisionbranches Demo",
        #                                 "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":True,"postTree":False,"min_pts":10},
        #                                 "njobs": 1,
        #                                 "dtype":"float64",
        #                         },
        #                         "ens": {
        #                                 "ens_nestimators":25,
        #                                 "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":False},
        #                                 "njobs": None,
        #                                 "display_name": "Decisionbranches Ensemble (25 trees)",
        #                                 "dtype":"float64",
        #                         },
        #                         "dtree": {
        #                                 "dtree_cfg":{},
        #                                 "display_name": "Decision Tree",
        #                                 "dtype":"float32",

        #                         },
        #                         "rf": {
        #                                 "rf_cfg": {"n_estimators":25},
        #                                 "display_name": "Random Forest (25t)",
        #                                 "dtype":"float32",
        #                         },
        #                         "nn":{
        #                                 "nn_k": 1000,
        #                                 "display_name": "Nearest Neighbor Search (k=1000)",
        #                         },
        #                         "boxnet1":{
        #                             "display_name": "HyperNN",
        #                             "nboxes":150,
        #                             "scaling":True,
        #                             "dtype": "float32",
        #                             "cfg": {"training_epochs":1000,
        #                                     "verbose":True,"l1_reg":0,
        #                                     "patience_early_stopping":500,"l2_reg":0,
        #                                     "learning_rate":1e-1,
        #                                     "num_threads":10,
        #                                     "alpha_tau_decay_step":25,
        #                                     "box_pruning_step":250,
        #                                     },
        #                         },
        #                 }

        #           },

                "shutterstock": {
                        "display_name": "shutterstock",
                        "feature_file": "assets/shutterstock_clip_features_d32.npy",#"assets/nrw_test_area_mapping.npy", #"assets/mapping_V2_part_50.npy",
                        "feature_mmap_path": "indexes/features",
                        "feature_mmap_dtype": "float32",
                        "size_dataset": 14_739_937,
                        "features_inmemory": True,#True, #False, for mmap
                        "non_rare_idxs": "auto",
                        "non_rare_idxs_num": 100_000,#30_000,
                        "nfeat":32,
                        "seed": 42,
                        "kdt_search":{
                                "index_file": None,#"assets/feature_subsets.npy",
                                "index_dir": "indexes/shutterstock",
                                "leafsize": 4500,
                                "dtype":"float64",
                                "build_inmemory":True,
                                "fidx_cfg": {"nfeat":4,"nind":32},#{"nfeat": 4,"nind":50},
                        },
                        "kdt_textsearch":{
                                "type": "kdtree",
                                "index_file": None,#"assets/feature_subsets.npy",
                                "index_dir": "indexes/shutterstock_text",
                                "leafsize": 4500,
                                "dtype":"float64",
                                "inmemory":False,
                                "build_inmemory":True,
                                "stop_leaves": 500,
                                # "fidx_cfg": {"nfeat":32,"nind":1},
                        },
                        "text_searcher":{
                                "model_weights_path":"assets/clip_weights_v3.pth",
                                "model_type": "CLIP",
                                "clip_cfg": {"model":"ViT-B/32","device":"cpu","train":False,"custom_head":True,"embed_dim":32,"hidden_dim":8192},
                        },
                        "searcher": {
                                "db-maxevals0.5-demo": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":True,"postTree":False,"min_pts":10},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "ens": {
                                        "ens_nestimators":25,
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":False},
                                        "njobs": None,
                                        "display_name": "Decisionbranches Ensemble (25 trees)",
                                        "dtype":"float64",
                                },
                                "dtree": {
                                        "dtree_cfg":{},
                                        "display_name": "Decision Tree",
                                        "dtype":"float32",

                                },
                                "rf": {
                                        "rf_cfg": {"n_estimators":25},
                                        "display_name": "Random Forest (25t)",
                                        "dtype":"float32",
                                },
                                "nn":{
                                        "nn_k": 1000,
                                        "display_name": "Nearest Neighbor Search (k=1000)",
                                },
                                "boxnet1":{
                                    "display_name": "HyperNN",
                                    "nboxes":150,
                                    "scaling":True,
                                    "dtype": "float32",
                                    "cfg": {"training_epochs":1000,
                                            "verbose":True,"l1_reg":0,
                                            "patience_early_stopping":500,"l2_reg":0,
                                            "learning_rate":1e-1,
                                            "num_threads":10,
                                            "alpha_tau_decay_step":25,
                                            "box_pruning_step":250,
                                            },
                                },
                        }

                  },

                        # New Demo 
                "unsplash_lite": {
                        "display_name": "unsplash_lite",
                        "feature_file": "assets/unsplash-lite_d32.npy",#"assets/nrw_test_area_mapping.npy", #"assets/mapping_V2_part_50.npy",
                        "feature_mmap_path": "indexes/features",
                        "feature_mmap_dtype": "float32",
                        "size_dataset": 22_761,
                        "features_inmemory": True,#True, #False, for mmap
                        "non_rare_idxs": "auto",
                        "non_rare_idxs_num": 2500,#30_000,
                        "nfeat":32,
                        "seed": 42,
                        "kdt_search":{
                                "index_file": None,#"assets/feature_subsets.npy",
                                "index_dir": "indexes/unsplash-lite",
                                "leafsize": 4500,
                                "build_inmemory":True,
                                "dtype":"float64",
                                "fidx_cfg": {"nfeat":4,"nind":32},#{"nfeat": 4,"nind":50},
                        },
                        "kdt_textsearch":{
                                "type": "kdtree",
                                "index_file": None,#"assets/feature_subsets.npy",
                                "index_dir": "indexes/unsplash-lite_text",
                                "leafsize": 4500,
                                "dtype":"float64",
                                "inmemory":False,
                                "build_inmemory":True,
                                # "fidx_cfg": {"nfeat":32,"nind":1},
                        },
                        "text_searcher":{
                                "model_weights_path":"assets/clip_weights_v3.pth",
                                "model_type": "CLIP",
                                "clip_cfg": {"model":"ViT-B/32","device":"cpu","train":False,"custom_head":True,"embed_dim":32,"hidden_dim":8192},
                        },
                        "searcher": {
                                "db-maxevals0.5-demo": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":True,"postTree":False,"min_pts":10},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "ens": {
                                        "ens_nestimators":25,
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":False},
                                        "njobs": None,
                                        "display_name": "Decisionbranches Ensemble (25 trees)",
                                        "dtype":"float64",
                                },
                                "dtree": {
                                        "dtree_cfg":{},
                                        "display_name": "Decision Tree",
                                        "dtype":"float32",

                                },
                                "rf": {
                                        "rf_cfg": {"n_estimators":25},
                                        "display_name": "Random Forest (25t)",
                                        "dtype":"float32",
                                },
                                "nn":{
                                        "nn_k": 1000,
                                        "display_name": "Nearest Neighbor Search (k=1000)",
                                },
                                "boxnet1":{
                                    "display_name": "HyperNN",
                                    "nboxes":150,
                                    "scaling":True,
                                    "dtype": "float32",
                                    "cfg": {"training_epochs":1000,
                                            "verbose":True,"l1_reg":0,
                                            "patience_early_stopping":500,"l2_reg":0,
                                            "learning_rate":1e-1,
                                            "num_threads":10,
                                            "alpha_tau_decay_step":25,
                                            "box_pruning_step":250,
                                            },
                                },
                        }

                  },
        "unsplash_lite_512": {
                        "display_name": "unsplash_lite_512",
                        "feature_file": "assets/unsplash-lite_d512_norm.npy",#"assets/nrw_test_area_mapping.npy", #"assets/mapping_V2_part_50.npy",
                        "feature_mmap_path": "indexes/features",
                        "feature_mmap_dtype": "float32",
                        "size_dataset": 22_761,
                        "features_inmemory": True,#True, #False, for mmap
                        "non_rare_idxs": "auto",
                        "non_rare_idxs_num": 2500,#30_000,
                        "nfeat":512,
                        "seed": 42,
                        "kdt_search":{
                                "index_file": None,#"assets/feature_subsets.npy",
                                "index_dir": "indexes/unsplash-lite-512",
                                "leafsize": 4500,
                                "build_inmemory":True,
                                "dtype":"float64",
                                "fidx_cfg": {"nfeat":4,"nind":32},#{"nfeat": 4,"nind":50},
                        },
                        "kdt_textsearch":{
                                "type": "kdtree",
                                "index_file": None,#"assets/feature_subsets.npy",
                                "index_dir": "indexes/unsplash-lite-512_text",
                                "leafsize": 4500,
                                "dtype":"float64",
                                "inmemory":False,
                                "build_inmemory":True,
                                # "fidx_cfg": {"nfeat":32,"nind":1},
                        },
                        "text_searcher":{
                                "model_weights_path":None,#"assets/clip_weights_v3.pth",
                                "model_type": "CLIP",
                                "clip_cfg": {"model":"ViT-B/32","device":"cpu","train":False,"custom_head":False,"embed_dim":512,"hidden_dim":8192},
                        },
                        "searcher": {
                                "db-maxevals0.5-demo": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":True,"postTree":False,"min_pts":10},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "ens": {
                                        "ens_nestimators":25,
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":False},
                                        "njobs": None,
                                        "display_name": "Decisionbranches Ensemble (25 trees)",
                                        "dtype":"float64",
                                },
                                "dtree": {
                                        "dtree_cfg":{},
                                        "display_name": "Decision Tree",
                                        "dtype":"float32",

                                },
                                "rf": {
                                        "rf_cfg": {"n_estimators":25},
                                        "display_name": "Random Forest (25t)",
                                        "dtype":"float32",
                                },
                                "nn":{
                                        "nn_k": 1000,
                                        "display_name": "Nearest Neighbor Search (k=1000)",
                                },
                                "boxnet1":{
                                    "display_name": "HyperNN",
                                    "nboxes":150,
                                    "scaling":True,
                                    "dtype": "float32",
                                    "cfg": {"training_epochs":1000,
                                            "verbose":True,"l1_reg":0,
                                            "patience_early_stopping":500,"l2_reg":0,
                                            "learning_rate":1e-1,
                                            "num_threads":10,
                                            "alpha_tau_decay_step":25,
                                            "box_pruning_step":250,
                                            },
                                },
                        }

                  },


                "cifar": {
                        "display_name": "CIFAR",
                        "feature_file": "assets/cifar10_features_nfeat512_norm.npy", #"assets/cifar10_features_nfeat512.npy",
                        "feature_mmap_path": "indexes/features",
                        "feature_mmap_dtype": "float32",
                        "size_dataset": 50_000,
                        "features_inmemory": True,#True, #False, for mmap
                        "non_rare_idxs": "auto",
                        "non_rare_idxs_num": 500,#30_000,
                        "nfeat":512,
                        "seed": 42,
                        "kdt_search":{
                                "index_file": None,#"assets/feature_subsets.npy",
                                "index_dir": "indexes/cifar",
                                "leafsize": 4500,
                                "dtype":"float64",
                                "build_inmemory":True,
                                "fidx_cfg": {"nfeat":16,"nind":100},#{"nfeat": 4,"nind":50},
                        },
                        "kdt_textsearch":{
                                "type": "kdtree",
                                "index_file": None,#"assets/feature_subsets.npy",
                                "index_dir": "indexes/cifar_text",
                                "leafsize": 4500,
                                "dtype":"float64",
                                "build_inmemory":True,
                                "inmemory":False,
                                # "fidx_cfg": {"nfeat":32,"nind":1},
                        },
                        "text_searcher":{
                                "model_weights_path":None,#"assets/clip_weights_v10.pth",
                                "model_type": "CLIP",
                                "clip_cfg": {"model":"ViT-B/32","device":"cpu","train":False,"custom_head":False,"embed_dim":512,"hidden_dim":8192},
                        },
                        "searcher": {
                                "db-maxevals0.5-demo": {
                                        "display_name": "Decisionbranches Demo",
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":True,"postTree":False,"min_pts":10},
                                        "njobs": 1,
                                        "dtype":"float64",
                                        "min_box_size": None,
                                },
                                "ens": {
                                        "ens_nestimators":25,
                                        "db_cfg":{"max_nbox":30,"top_down":False,"max_evals":0.5,"stop_infinite":False,"postTree":False},
                                        "njobs": None,
                                        "display_name": "Decisionbranches Ensemble (25 trees)",
                                        "dtype":"float64",
                                },
                                "dtree": {
                                        "dtree_cfg":{},
                                        "display_name": "Decision Tree",
                                        "dtype":"float32",

                                },
                                "rf": {
                                        "rf_cfg": {"n_estimators":25},
                                        "display_name": "Random Forest (25t)",
                                        "dtype":"float32",
                                },
                                "nn":{
                                        "nn_k": 1000,
                                        "display_name": "Nearest Neighbor Search (k=1000)",
                                },
                                "boxnet1":{
                                    "display_name": "HyperNN",
                                    "nboxes":150,
                                    "scaling":True,
                                    "dtype": "float32",
                                    "cfg": {"training_epochs":1000,
                                            "verbose":True,"l1_reg":0,
                                            "patience_early_stopping":500,"l2_reg":0,
                                            "learning_rate":1e-1,
                                            "num_threads":10,
                                            "alpha_tau_decay_step":25,
                                            "box_pruning_step":250,
                                            },
                                },
                        }

                  },
 
        }

